<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Perfil ‚Ä¢ Chef Express</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <main class="container main-content">
    <h1>Meu Perfil</h1>

    <p>Nome: <span id="userNome"></span></p>
    <p>E-mail: <span id="userEmail"></span></p>
    <p>Endere√ßo: <span id="userEndereco"></span> 
      <button id="trocarEnderecoBtn">Trocar endere√ßo</button>
    </p>
    <button id="logoutBtn">Sair</button>

    <h2>Meus Pedidos</h2>
    <ul id="listaPedidos"></ul>
  </main>

  <script>
    // Pegar dados do usu√°rio do localStorage
    const usuario = JSON.parse(localStorage.getItem("usuario"));

    if (!usuario) {
      alert("Voc√™ precisa fazer login primeiro");
      location.href = "login.html";
    }

    // Preencher dados do perfil
    document.getElementById("userNome").textContent = usuario.nome;
    document.getElementById("userEmail").textContent = usuario.email;
    document.getElementById("userEndereco").textContent = usuario.endereco1;

    // Trocar endere√ßo
    document.getElementById("trocarEnderecoBtn").addEventListener("click", () => {
      const novoEndereco = prompt("Digite seu novo endere√ßo:");
      if (novoEndereco) {
        usuario.endereco1 = novoEndereco;
        document.getElementById("userEndereco").textContent = novoEndereco;
        localStorage.setItem("usuario", JSON.stringify(usuario));
        alert("Endere√ßo atualizado!");
      }
    });

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("usuario");
      location.href = "login.html";
    });

    // Carregar pedidos (apenas do usu√°rio logado)
    async function carregarPedidos() {
      let pedidos = [];
      try {
        const res = await fetch("http://localhost:3000/pedidos");
        if (res.ok) pedidos = await res.json();
      } catch {
        console.warn("‚ö†Ô∏è Sem rota de pedidos no servidor, usando localStorage");
      }

      if (!pedidos.length) {
        pedidos = JSON.parse(localStorage.getItem("pedidos") || "[]");
      }

      pedidos = pedidos.filter(p => p.email === usuario.email);

      const lista = document.getElementById("listaPedidos");
      lista.innerHTML = "";
      if (pedidos.length === 0) {
        lista.innerHTML = "<li>Nenhum pedido ainda.</li>";
      } else {
        pedidos.forEach(p => {
          const li = document.createElement("li");
          li.textContent = `üßæ Pedido #${p.id} ‚Ä¢ Total: R$ ${p.total} ‚Ä¢ ${p.data}`;
          lista.appendChild(li);
        });
      }
    }

    carregarPedidos();
  </script>
</body>
</html>
